# 缓存穿透、缓存击穿、缓存雪崩

### 缓存穿透

#### 定义

查询一个一定不存在的数据，导致每次都从DB去查询，失去了缓存的意义。可能被利用不存在的key频繁查询攻击DB。

#### 解决方案

1. 利用布隆过滤器，将所有可能存在的key存到一个bitmap中，如果查询的ket不存在就会被拦截掉；
2. 查询key的结果为空时，将key-null写入缓存，设置一个较短的过期时间。

### 缓存击穿

#### 定义

一个存在的key，在过期的一瞬间同时收到大量的请求，这些都会击穿到DB，造成DB压力骤增。

#### 解决方案

1. 设置热点数据永远不过期
2. 使用互斥锁，在缓存失效的时候，不立即从DB查询，而是先使用缓存工具的某些带成功操作返回值的操作（比如Redis的SETNX或者Memcache的ADD）去set一个mutex key，当操作返回成功时，再进行load db的操作并回设缓存；否则，就重试整个get缓存的方法。

### 缓存雪崩

#### 定义

缓存中数据大批量到过期时间，而查询数据量巨大，引起DB压力过大。

#### 解决方案

1.  缓存数据的过期时间设置随机，防止同一时间大量数据过期现象发生。
2.  如果缓存数据库是分布式部署，将热点数据均匀分布在不同搞得缓存数据库中。
3.  设置热点数据永远不过期。











