# 怎样让你的代码更好的被JVM JIT Inlining

[https://rongmayisheng.com/%e6%80%8e%e6%a0%b7%e8%ae%a9%e4%bd%a0%e7%9a%84%e4%bb%a3%e7%a0%81%e6%9b%b4%e5%a5%bd%e7%9a%84%e8%a2%abjvm-jit-inlining/](https://rongmayisheng.com/%e6%80%8e%e6%a0%b7%e8%ae%a9%e4%bd%a0%e7%9a%84%e4%bb%a3%e7%a0%81%e6%9b%b4%e5%a5%bd%e7%9a%84%e8%a2%abjvm-jit-inlining/)

jvm可以通过两个启动参数来控制**字节码**大小为多少的方法可以被内联：

* _-XX:MaxInlineSize_：能被内联的方法的最大字节码大小，默认值为35B，这种方法不需要频繁的调用。比如：一般pojo类中的getter和setter方法，它们不是那种调用频率特别高的方法，但是它们的字节码大小非常短，这种方法会在执行后被内联。
* _-XX:FreqInlineSize_：调用很频繁的方法能被内联的最大字节码大小，这个大小可以比MaxInlineSize大，默认值为325B（和平台有关，我的机器是64位mac）

要想inlining就要让你的方法的字节码变得尽可能的小，默认情况下，你的方法要么小于35B（针对普通方法），要么小于325B（针对调用频率很高的方法）。

### 为Inlining减少方法字节码

#### 1. 把分支语句中的代码段抽取到方法中

我们的代码里面常常会有分支语句，比如：if-else、switch。但是我仔细想想，是不是所有的分支都有均等的执行机会，是不是很多时候，某些分支能进入的概率很小或者几乎没有。如果某个分支执行的概率很小，而且这个分支中的代码量不算小，那把这个分支中的代码抽取成一个方法就可以大大缩减当前这个方法的字节码大小。

#### 2. 移除无用的代码

#### 3. 抽取重复的代码

#### 4. 优化常量加减运算

#### 5. 移除无用的初始化赋值

#### 6. 尽量复用临时变量

#### 7. 减少传参个数

#### 8. 把多个if判断转变成map的contain或者数组取下标操作

#### 9. 必要时把JDK中的类重写成简单的版本

